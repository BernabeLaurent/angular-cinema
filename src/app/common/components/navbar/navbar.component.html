<!-- Barre de navigation -->
<mat-toolbar color="primary" class="transparent-toolbar">
  <div class="left-section">
    <div class="logo-container" routerLink="/">
      <img src="assets/images/logo.svg" alt="Tchitcha" class="logo" height="32">
      <span class="logo-text">TCHITCHA</span>
    </div>
    <!-- Menu burger pour mobile -->
    <button mat-icon-button class="mobile-menu-button hamburger-debug" (click)="toggleMobileMenu()"
            style="display: block !important; background: red !important; color: white !important; z-index: 9999 !important; position: relative !important;">
      <mat-icon>menu</mat-icon>
    </button>

    <!-- Bouton recherche mobile (toujours visible) -->
    <button mat-icon-button class="mobile-search-button" (click)="openSearchModal()">
      <mat-icon>search</mat-icon>
    </button>

    <!-- Boutons desktop -->
    <div class="desktop-nav">
      <button mat-icon-button (click)="openSearchModal()">
        <mat-icon>search</mat-icon>
      </button>
      <button mat-button routerLink="/movies">Films</button>
      <button mat-button routerLink="/booking">Réserver</button>
    </div>
    
    <!-- Menu Administration pour les admins et workers -->
    <ng-container *ngIf="canAccessAdmin$ | async">
      <button mat-button [matMenuTriggerFor]="adminMenu" class="admin-menu-trigger desktop-only">
        <mat-icon>admin_panel_settings</mat-icon>
        Administration
        <mat-icon>arrow_drop_down</mat-icon>
      </button>
      <mat-menu #adminMenu="matMenu" class="admin-dropdown-menu">
        <button mat-menu-item routerLink="/admin/dashboard">
          <mat-icon>dashboard</mat-icon>
          Tableau de bord
        </button>
        <!-- Gestion des utilisateurs - ADMIN uniquement -->
        <button mat-menu-item routerLink="/admin/users" *ngIf="isAdmin$ | async">
          <mat-icon>people</mat-icon>
          Gestion des utilisateurs
        </button>
        <!-- Gestion des cinémas - ADMIN uniquement -->
        <button mat-menu-item routerLink="/admin/theaters" *ngIf="isAdmin$ | async">
          <mat-icon>location_city</mat-icon>
          Gestion des cinémas
        </button>
        <!-- Gestion des films - ADMIN et WORKER -->
        <button mat-menu-item routerLink="/admin/movies">
          <mat-icon>movie</mat-icon>
          Gestion des films
        </button>
        <!-- Gestion des réservations - ADMIN et WORKER -->
        <button mat-menu-item routerLink="/admin/bookings">
          <mat-icon>event_seat</mat-icon>
          Gestion des réservations
        </button>
      </mat-menu>
    </ng-container>
  </div>
  <span class="spacer"></span>

  <!-- Overlay pour fermer le menu mobile -->
  <div class="mobile-menu-overlay" *ngIf="isMobileMenuOpen" (click)="closeMobileMenu()"></div>

  <!-- Menu mobile -->
  <div class="mobile-menu" *ngIf="isMobileMenuOpen">
    <div class="mobile-menu-content">
      <button mat-button routerLink="/movies" (click)="closeMobileMenu()">
        <mat-icon>movie</mat-icon>
        Films
      </button>
      <button mat-button routerLink="/booking" (click)="closeMobileMenu()">
        <mat-icon>event_seat</mat-icon>
        Réserver
      </button>

      <!-- Menu Administration pour mobile -->
      <ng-container *ngIf="canAccessAdmin$ | async">
        <mat-divider></mat-divider>
        <div class="admin-section">
          <p class="section-title">Administration</p>
          <button mat-button routerLink="/admin/dashboard" (click)="closeMobileMenu()">
            <mat-icon>dashboard</mat-icon>
            Tableau de bord
          </button>
          <button mat-button routerLink="/admin/users" *ngIf="isAdmin$ | async" (click)="closeMobileMenu()">
            <mat-icon>people</mat-icon>
            Gestion des utilisateurs
          </button>
          <button mat-button routerLink="/admin/theaters" *ngIf="isAdmin$ | async" (click)="closeMobileMenu()">
            <mat-icon>location_city</mat-icon>
            Gestion des cinémas
          </button>
          <button mat-button routerLink="/admin/movies" (click)="closeMobileMenu()">
            <mat-icon>movie</mat-icon>
            Gestion des films
          </button>
          <button mat-button routerLink="/admin/bookings" (click)="closeMobileMenu()">
            <mat-icon>event_seat</mat-icon>
            Gestion des réservations
          </button>
        </div>
      </ng-container>
    </div>
  </div>
  
  <!-- Menu utilisateur -->
  <div class="user-menu-container">
    <!-- Si utilisateur non connecté -->
    <ng-container *ngIf="!(isLoggedIn$ | async)">
      <button mat-button (click)="openLoginDialog()" class="login-btn">
        Se connecter
      </button>
      <button mat-raised-button (click)="openRegisterDialog()" class="register-btn">
        S'inscrire
      </button>
    </ng-container>
    
    <!-- Si utilisateur connecté -->
    <ng-container *ngIf="isLoggedIn$ | async">
      <button #userMenuButton mat-icon-button (click)="toggleUserMenu()" class="user-avatar">
        <div class="avatar-circle">
          {{ userInitials$ | async }}
        </div>
      </button>
      
      <div class="user-menu" *ngIf="isUserMenuOpen">
        <div class="user-menu-content">
          <div class="user-info" *ngIf="currentUser$ | async as user">
            <div class="user-details">
              <strong>{{ user.email }}</strong>
              <span class="role-badge">{{ getRoleDisplayName(user.roleUser || user.role!) }}</span>
            </div>
          </div>
          
          <mat-divider></mat-divider>
          
          <div class="menu-section">
            <button mat-button class="full-width" routerLink="/profile" (click)="closeUserMenu()">
              <mat-icon>person</mat-icon>
              Mon profil
            </button>
            <button mat-button class="full-width" routerLink="/my-bookings" (click)="closeUserMenu()">
              <mat-icon>event_seat</mat-icon>
              Mes réservations
            </button>
            
            <!-- Liens spécifiques aux admins -->
            <ng-container *ngIf="isAdmin$ | async">
              <button mat-button class="full-width" routerLink="/admin/users" (click)="closeUserMenu()">
                <mat-icon>people</mat-icon>
                Gestion utilisateurs
              </button>
              <button mat-button class="full-width" routerLink="/admin/movies" (click)="closeUserMenu()">
                <mat-icon>theaters</mat-icon>
                Gestion films
              </button>
            </ng-container>
          </div>
          
          <mat-divider></mat-divider>
          
          <div class="menu-section">
            <button mat-button class="full-width logout-btn" (click)="logout()">
              <mat-icon>logout</mat-icon>
              Se déconnecter
            </button>
          </div>
        </div>
      </div>
    </ng-container>
  </div>
</mat-toolbar>
